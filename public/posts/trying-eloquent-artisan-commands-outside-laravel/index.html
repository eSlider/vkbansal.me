<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <base href="">
        <title> | Blog | Vivek Kumar Bansal, frontend developer and designer</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700 | Roboto+Slab' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="css/fonts.css">
        <link rel="stylesheet" href="css/styles.css">
    </head>
    <body class="blog">
        <nav class="off-canvas">
            <ul class="main-nav">
                <li>
                    <a href="./">
                        <svg class="icon">
                            <use xlink:href="#navicon-home" />
                        </svg>Home
                    </a>
                </li>
                <li>
                    <a href="/about/">
                        <svg class="icon">
                            <use xlink:href="#navicon-about" />
                        </svg>About
                    </a>
                </li>
                <li>
                    <a href="/work/">
                        <svg class="icon">
                            <use xlink:href="#navicon-work" />
                        </svg>Work
                    </a>
                </li>
                <li>
                    <a href="/blog/">
                        <svg class="icon">
                            <use xlink:href="#navicon-blog" />
                        </svg>Blog
                    </a>
                </li>
                <li>
                    <a href="/contact/">
                        <svg class="icon">
                            <use xlink:href="#navicon-contact" />
                        </svg>Contact
                    </a>
                </li>
            </ul>
            <footer class="connect">
                <p class="social">Connect with me</p>
                <ul class="social">
                    <li>
                        <a href="https://www.facebook.com/vkbansal.me" class="facebook">
                          <svg class="icon">
                                <use xlink:href="#navicon-facebook" />
                            </svg>
                        </a>
                    </li>
                    <li>
                        <a href="http://twitter.com/_vkbansal" class="twitter">
                            <svg class="icon">
                                <use xlink:href="#navicon-twitter" />
                            </svg>
                        </a>
                    </li>
                    <li>
                        <a href="https://plus.google.com/104240046366721765666" rel="publisher" class="google-plus">
                            <svg class="icon">
                                <use xlink:href="#navicon-gplus" />
                            </svg>
                        </a>
                    </li>
                    <li>
                        <a href="https://github.com/vkbansal" class="github">
                            <svg class="icon">
                                <use xlink:href="#navicon-github" />
                            </svg>
                        </a>
                    </li>
                    <li>
                        <a href="https://www.behance.net/vkbansal" class="behance">
                            <svg class="icon">
                                <use xlink:href="#navicon-behance" />
                            </svg>
                        </a>
                    </li>
                    <li>
                        <a href="https://in.linkedin.com/in/vkb0310" class="linkedin">
                            <svg class="icon">
                                <use xlink:href="#navicon-linkedin" />
                            </svg>
                        </a>
                    </li>
                </ul>
            </footer>
        </nav>
        <div id="canvas-container" class="canvas-container"></div>
        <div class="fixed-toggle hide" id="fixed-toggle">
                <button class="toggle-offcanvas" id="fixed-toggle-button">
                    <span class="lines"></span>
                </button>
        </div>
        <div class="site-canvas" id="site-canvas">
            <header class="site-header">
                <div class="container">
                    <button class="toggle-offcanvas" id="toggle-offcanvas">
                        <span class="lines"></span>
                    </button>
                    <span class="info"></span>
                    <h1 class="title">V<span>ivek </span>K<span>umar </span>Bansal</h1>
                </div>
            </header>
            <div id="site-content" class="site-content">
                
<div class="container">
    <div class="row">
        <div class="blog-title">
            <h1></h1>
            <small class="post-meta">By <a href=""></a> </small>
        </div>
    </div>
    <div class="row">
        <div class="blog-sidebar-left">
            <ul class="share">
                <li>Share this:</li>
                <li><a href="https://www.facebook.com/sharer/sharer.php?u=">Facebook</a></li>
                <li><a href="https://twitter.com/intent/tweet?url=&text=&via=_vkbansal">Twitter</a></li>
                <li><a href="https://plus.google.com/share?url=">Google+</a></li>
            </ul>
            <ul class="share">
                <li>Follow me:</li>
                <li><a href="http://feeds.feedburner.com/vkbansal">RSS</a></li>
                <li><a href="https://github.com/vkbansal">Github</a></li>
                <li><a href="https://www.facebook.com/vkbansal.me">Facebook</a></li>
                <li><a href="https://twitter/_vkbansal">Twitter</a></li>
            </ul>
        </div>
        <div class="blog-content">
            &lt;p&gt;In my last blog post, we had a look at &lt;a href=&quot;/blog/using-eloquent-outside-laravel&quot;&gt;using Eloquent outside laravel&lt;/a&gt;. One of the great things about Eloquent is Migrations. It&#39;s like a version control for your database schema. Laravel comes with this useful command line tool called &lt;code&gt;artisan&lt;/code&gt;, which makes it easy to make and run migrations. Since I was using Eloquent outside laravel, I had this (crazy) idea of trying to use the migration &lt;code&gt;artisan&lt;/code&gt; commands along with it (i.e outside laravel).&lt;/p&gt;
&lt;h2&gt;Setup&lt;/h2&gt;
&lt;p&gt;Eloquent suggests installing &lt;code&gt;illuminate\console&lt;/code&gt; and &lt;code&gt;illuminate\filesystem&lt;/code&gt; to run the migration commands. So I update my &lt;code&gt;composer.json&lt;/code&gt; accordingly and installed the requierd packages.&lt;/p&gt;
&lt;p&gt;I made a file called &lt;code&gt;artsy&lt;/code&gt; and put the following content in it:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-php&quot;&gt;&amp;lt;?php
require_once &amp;quot;vendor/autoload.php&amp;quot;;
use Symfony\Component\Console\Application;

$app = new Application(&amp;quot;Artsy, little brother of Artisan&amp;quot;, &amp;quot;1.0&amp;quot;);

$app-&amp;gt;run();
&lt;/code&gt;&lt;/pre&gt;
&lt;h2&gt;Including commands&lt;/h2&gt;
&lt;p&gt;My first aim was to add  &lt;code&gt;migrate:install&lt;/code&gt; and &lt;code&gt;make:migrate&lt;/code&gt; commands which would insert required migration tables to the database and run migrations respectively. After going through the database component&#39;s code, I realized that the components have a crazy dependency on each other and required a lot of boostrapping (which is obviously handled by Laravel internally). To ease this task a bit, I decided to use &lt;code&gt;Pimple&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;After a bit struggle, I finally figured out the dependencies and also that I&#39;ll need to mock &lt;code&gt;Illuminate\Foundation\Composer&lt;/code&gt; for &lt;code&gt;make:migrate&lt;/code&gt; command. So I also included &lt;code&gt;Mockery&lt;/code&gt;. And after all this my &lt;code&gt;artsy&lt;/code&gt; file looked like this:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-php&quot;&gt;&amp;lt;?php
require_once &amp;quot;vendor/autoload.php&amp;quot;;

use Symfony\Component\Console\Application;
use Illuminate\Database\Console\Migrations;
use Pimple\Container;

$container = new Container();

$container[&#39;migration-table&#39;] = &#39;migration&#39;;

$container[&#39;db-config&#39;] = [
    &#39;driver&#39;    =&amp;gt; &#39;pgsql&#39;,
    &#39;host&#39;      =&amp;gt; &#39;localhost&#39;,
    &#39;database&#39;  =&amp;gt; &#39;dummy&#39;,
    &#39;username&#39;  =&amp;gt; &#39;postgres&#39;,
    &#39;password&#39;  =&amp;gt; &#39;postgres&#39;,
    &#39;charset&#39;   =&amp;gt; &#39;utf8&#39;,
    &#39;prefix&#39;    =&amp;gt; &#39;&#39;,
    &#39;schema&#39;   =&amp;gt; &#39;public&#39;
];

$container[&#39;filesytem&#39;] = function ($c) {
    return new \Illuminate\Filesystem\Filesystem;
};

$container[&#39;composer&#39;] = function ($c) {
    $composer = Mockery::mock(&#39;Illuminate\Foundation\Composer&#39;);
    $composer-&amp;gt;shouldReceive(&#39;dumpAutoloads&#39;);
    return $composer;
};

$container[&#39;connection&#39;] = function ($c) {
    $manager = new \Illuminate\Database\Capsule\Manager();
    $manager-&amp;gt;addConnection($c[&#39;db-config&#39;]);
    $manager-&amp;gt;setAsGlobal();
    $manager-&amp;gt;bootEloquent();
    return $manager-&amp;gt;getConnection(&#39;default&#39;);
};

$container[&#39;resolver&#39;] = function ($c) {
    $r = new \Illuminate\Database\ConnectionResolver([&#39;default&#39; =&amp;gt; $c[&#39;connection&#39;]]);
    $r-&amp;gt;setDefaultConnection(&#39;default&#39;);
    return $r;
};

$container[&#39;migration-repo&#39;] = function ($c) {
    return new \Illuminate\Database\Migrations\DatabaseMigrationRepository($c[&#39;resolver&#39;], $c[&#39;migration-table&#39;]);
};

$container[&#39;migration-creator&#39;] = function ($c) {
    return new \Illuminate\Database\Migrations\MigrationCreator($c[&#39;filesytem&#39;]);
};

$container[&#39;migrator&#39;] = function ($c) {
    return new Illuminate\Database\Migrations\Migrator($c[&#39;migration-repo&#39;], $c[&#39;resolver&#39;], $c[&#39;filesytem&#39;]);
};

$container[&#39;install-command&#39;] = function ($c) {
    $command = new Migrations\InstallCommand($c[&#39;migration-repo&#39;]);
    return $command;
};

$container[&#39;migrate-make-command&#39;] = function ($c) {
    $command = new Migrations\MigrateMakeCommand($c[&#39;migration-creator&#39;], $c[&#39;composer&#39;]);
    return $command;
};

$app = new Application(&amp;quot;Foo&amp;quot;, &amp;quot;1.0&amp;quot;);
$app-&amp;gt;add($container[&#39;install-command&#39;]);
$app-&amp;gt;add($container[&#39;migrate-make-command&#39;]);

&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Now running on running &lt;code&gt;php artsy&lt;/code&gt;, showed me:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;Artsy, little brother of Artisan 1.0

Usage:
 [options] command [arguments]

Options:
 --help (-h)           Display this help message
 --quiet (-q)          Do not output any message
 --verbose (-v|vv|vvv) Increase the verbosity of messages: 1 for normal output, 2 for more verbose output and 3 for debug
 --version (-V)        Display this application version
 --ansi                Force ANSI output
 --no-ansi             Disable ANSI output
 --no-interaction (-n) Do not ask any interactive question

Available commands:
 help              Displays help for a command
 list              Lists commands
make
 make:migration    Create a new migration file
migrate
 migrate:install   Create the migration repository
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Everything looked good till now. But upon running &lt;code&gt;php artsy migrate:install&lt;/code&gt;, I got the following error.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-bash&quot;&gt;PHP Fatal error:  Call to a member function call() on null in E:\demo\vendor\illuminate\console\Command.php on line 115
PHP Stack trace:
PHP 1. {main}() E:\demo\artsy:0
PHP 2. Symfony\Component\Console\Application-&amp;gt;run() E:\demo\artsy:48
PHP 3. Symfony\Component\Console\Application-&amp;gt;doRun() E:\demo\vendor\symfony\console\Symfony\Component\Console\Application.php:126
PHP 4. Symfony\Component\Console\Application-&amp;gt;doRunCommand() E:\demo\vendor\symfony\console\Symfony\Component\Console\Application.php:195
PHP 5. Illuminate\Console\Command-&amp;gt;run() E:\demo\vendor\symfony\console\Symfony\Component\Console\Application.php:874
PHP 6. Symfony\Component\Console\Command\Command-&amp;gt;run() E:\demo\vendor\illuminate\console\Command.php:101
PHP 7. Illuminate\Console\Command-&amp;gt;execute() E:\demo\vendor\symfony\console\Symfony\Component\Console\Command\Command.php:253
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Upon inspecting &lt;code&gt;Command.php&lt;/code&gt; in &lt;code&gt;illuminate\console&lt;/code&gt; package, I found that the follwing line (L115) was the culprit.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-php&quot;&gt;return $this-&amp;gt;laravel-&amp;gt;call([$this, $method]);
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;As you can see, a whole instance of &lt;code&gt;laravel&lt;/code&gt; is required even for running a simple console command!!!!&lt;/p&gt;
&lt;p&gt;I tried mocking it too but the command did not do anything as expected and I could not think of a way to do it (with my limited knowledge of PHP) without implementing the whole &lt;code&gt;Illuminate\Contracts\Foundation\Application&lt;/code&gt; interface with 20+ methods.&lt;/p&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;Laravel components are not as flexible or should I say loosely couple as that of Symfony&#39;s. I wish they had been, but I&#39;m no Taylor Otwell.&lt;/p&gt;
&lt;p&gt;This was me just trying out some crazy idea and trying to learn stuff. If any one of you know a better solution, I would really like to discuss it. You can leave a comment below or tweet me &lt;a href=&quot;https://twitter.com/_vkbansal&quot;&gt;@_vkbansal&lt;/a&gt;&lt;/p&gt;

        </div>
        <div class="blog-sidebar-right">
            <ul class="recent-posts">
                <li>Recent posts:</li>
                
            </ul>
        </div>
    </div>
    <div id="disqus_thread"></div>
    
    <!--script type="text/javascript">
        var disqus_shortname = 'vkbansal',
            disqus_identifier = '',
            disqus_title = '';
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script-->
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    
</div>

            </div>
            
            <footer class="container center footer" id="hire-me">
                <h2 class="heading">Want to work with me?</h2>
                <p>If you like what you've seen and want to hire me, Just hit the link below.</p>
                <p><a href="/project-planner/" class="button">Plan a Project </a></p>
            </footer>
            
        </div>
        <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="js/vendor/jquery.min.js"><\/script>')</script>
        <script type="text/javascript" src="js/plugins.min.js"></script>
        <script type="text/javascript" src="js/main.js"></script>
        
        
        
    </body>
</html>
